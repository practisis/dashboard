<!DOCTYPE html>
	<html lang="en">
		<head>
			<meta charset="utf-8">
			<meta http-equiv="X-UA-Compatible" content="IE=edge">
			<title>Web Application</title>
			<script language="javascript" type="text/javascript" src="js/jquery.js"></script>
			<script language="javascript" type="text/javascript" src="js/jquery-ui.min.js"></script>
			<meta name="description" content="">
			<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
		  
			<link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
			<link rel="stylesheet" href="css/bootstrap.css">
			<script type="text/javascript" src="cordova.js"></script>
			<script type="text/javascript" src="js/bootstrap.js"></script>
			<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
			<link rel="stylesheet" href="css/main_formated.css">
			<script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
			<script src="http://cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
			<style>
			 .pelota{   
				display: block;
				float: left;
				margin: 0px 10px 10px 0px;
				width: 65px;
				height: 65px;
				border-radius: 50%;
				line-height: 65px;
				vertical-align: middle;
				text-align: center; 
				font-size: 35px;
				 }   
				 #formalocales{
					-moz-appearance: none;
					background: #042446 url("arrow.png") no-repeat scroll 100% center;
					border: 0 none !important;
					color: #fff;
					font-size: 18px;
					height: 40px;
					padding: 10px;
					text-indent: 0.01px;
					text-overflow: "";
					text-transform: uppercase;
					width: 100%;
				 }
				 .conpelota{
					width:100px;
				 }
			</style>
		</head>
		<body onload="datosiniciales();">
			<div class="container" >
				<div class="row" style="background: #000">
					<div class="col-md-12" style="text-align: center; background-color:black;color:#fff; font-size: 20px; padding-bottom: 10px; padding-top: 5px;">
					<h3>Practisis Abaco</h3>
					</div>              
				</div>
				<div class="row" style="background: #000;padding:10px;color:#fff;">
					<div class='col-md-12' style="padding-left:20px;text-align:left;padding-right:20px;">
						<div style='float:left;'>
							<span id='welcome'></span>  
						</div>
						<div style='float:right;background-color:#286090;padding:5px;color:#fff;border-radius:5px;'>
							<i class="fa fa-sign-out" onclick='salir()'>LogOut</i>
						</div>
						<div style='width:20px;padding:5px;float:right;'></div>
						<div id='otraConsulta' style='display:none;text-align:center;float:right;'>
							<div style='background-color:#FFB61C;color:#fff;padding:5px;width:160px;margin:0 auto;border-radius:5px' onclick="nuevaConsulta();">
								Envia Nueva Consulta
							</div>
						</div>
						
					</div>
					
				</div>
				<div class="row" style="padding-top: 10px;padding-bottom: 10px;">
					<div class="col-md-12">
						<div class="panel panel-default">
							<div  class="panel-heading"  id='datosLocalSeleccionado'>
								<strong><span class="glyphicon glyphicon-th"></span></strong>
								<div >DATOS FILTRO</div>
							</div>
							<div class="panel-body" id='consulta'>
								<label>Establecimiento</label>
								<select class="form-control" id="formalocales">
								<option value='0'>Todos...</option>
								</select>
								<br/>
								<label>Fecha</label>
								<input id="lafecha" class="form-control" readonly />
								<input type='hidden' id='id_emp' />
								<br/>
								<div style="text-align: right;">
									<button type="button" class="btn btn-success" id='bntfiltrar' onclick="inicia();">Filtrar</button>
								</div>
							</div>
						</div>
					</div>	
				</div>



				 <div id="contenedordedatos" style="display:none;">       
					<div class="row">
							<div class="col-lg-4">
								<div class="panel panel-default">
									<div class="panel-body" >
										<table width='100%'>
											<tr>
												<td class='conpelota'>
													<span style="background-color: #e94b3b; color:#fff;" class="pelota">
														<i class="fa fa-shopping-cart"></i>
													</span>
												</td>
												<td>
													<table width='100%'>
														<tr>
															<td align='left' style='color:#777;font-size:13px;width:300px;'>
																<small >Venta Acumulada US$:</small>
															</td>
															<td align='center' style='font-weight:bolder;'>
																<span id="campoventas">10,263</span>
															</td>
														</tr>
														<tr>
															<td align='left' style='color:#777;font-size:13px;width:300px;'>
																<small>Ventas Dia US$:</small> 
															</td>
															<td align='center' style='font-weight:bolder;'>
																<span id="campoventasDia">10,263</span>
															</td>
														</tr>
													</table>
												</td>
											</tr>
										</table>
									</div>
								</div>
							</div>
								
							<div class="col-lg-4">
								<div class="panel panel-default">
									<div class="panel-body" >
										<table width='100%'>
											<tr>
												<td class='conpelota'>
													<span style="background-color: #23ae89; color:#fff;" class="pelota">
														<i class="fa fa-credit-card"></i>
													</span>
												</td>
												<td>
													<table width='100%'>
														<tr>
															<td align='left' style='color:#777;font-size:13px;width:300px;'>
																<small>Ticket Promedio US$:</small>
															</td>
															<td align='center' style='font-weight:bolder;'>
																<span id="campoticket"> 5,35</span>
															</td>
														</tr>
														<tr>
															<td align='left' style='color:#777;font-size:13px;width:300px;'>
																<small>Ticket Promedio Diario US$:</small>
															</td>
															<td align='center' style='font-weight:bolder;'>
																<span id="campoticketHoy"> 5,35</span>
															</td>
														</tr>
													</table>
												</td>
											</tr>
										</table>
									</div>
								</div>
							</div>
								 
							<div class="col-lg-4">
								<div class="panel panel-default">
									<div class="panel-body" >
										<table width='100%'>
											<tr>
												<td class='conpelota'>
													<span style="background-color: #ffb61c; color:#fff;" class="pelota">
														<i class="fa fa-users"></i>
													</span>
												</td>
												<td>
													<table width='100%'>
														<tr>
															<td align='left' style='color:#777;font-size:13px;width:300px;'>
																<small>Transacciones Mes:&nbsp;&nbsp;&nbsp;</small>
															</td>
															<td align='center' style='font-weight:bolder;'>
																<span id="campotransacciones">78</span>
															</td>
														</tr>
														<tr>
															<td align='left' style='color:#777;font-size:13px;width:300px;'>
																<small>Transacciones Dia:&nbsp;&nbsp;&nbsp;</small>
															</td>
															<td align='center' style='font-weight:bolder;'>
																<span id="campotransaccionesDia">78</span>
															</td>
														</tr>
													</table>
												</td>
											</tr>
										</table>
									</div>
								</div>
							</div>
							<div class="col-lg-4">
								<div class="panel panel-default">
									<div class="panel-body" >
										<table width='100%'>
											<tr>
												<td class='conpelota'>
													<span style="background-color: #23AE89; color:#fff;" class="pelota">
														<i class="fa fa-money"></i>
													</span>
												</td>
												<td>
													<table width='100%'>
														<tr>
															<td align='left' style='color:#777;font-size:13px;width:300px;'>
																<small>% Cumlimiento Ventas:</small>
															</td>
															<td align='center' style='font-weight:bolder;'>
																<span id="proyeccionAcumulada" style='font-size:12px;'>10,263</span>%
															</td>
														</tr>
														<tr>
															<td align='left' style='color:#777;font-size:13px;width:300px;'>
																<small>% Cumlimiento Ventas Dia:</small>
															</td>
															<td align='center' style='font-weight:bolder;'>
																<span id="proyeccionDia" style='font-size:12px;'>10,263</span>%
															</td>
														</tr>
													</table>
												</td>
											</tr>
										</table>
									</div>
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="panel panel-default">
									<div class="panel-body" >
										<table width='100%'>
											<tr>
												<td class='conpelota'>
													<span style="background-color: #FFB61C; color:#fff;" class="pelota">
														<i class="fa fa-dollar"></i>
													</span>
												</td>
												<td>
													<table width='100%'>
														<tr>
															<td align='left' style='color:#777;font-size:13px;width:300px;'>
																<small>Costo Total</small>
															</td>
															<td align='center' style='font-weight:bolder;'>
																<span id="utilidadAcumulada" style='font-size:12px;'>10,263</span>$
															</td>
														</tr>
													</table>
												</td>
											</tr>
										</table>
									</div>
								</div>
							</div>
							
							<div class="col-lg-4">
								<div class="panel panel-default">
									<div class="panel-body" >
										<table width='100%'>
											<tr>
												<td class='conpelota'>
													<span style="background-color: #2EC1CC; color:#fff;" class="pelota">
														<i class="fa fa-users"></i>
													</span>
												</td>
												<td>
													<table width='100%'>
														<tr>
															<td align='left' style='color:#777;font-size:13px;width:300px;'>
																<small>Porcentaje de Costos</small>
															</td>
															<td align='center' style='font-weight:bolder;'>
																<span id="costosTotales" style='font-size:12px;'>10,263</span>%
															</td>
														</tr>
													</table>
												</td>
											</tr>
										</table>
									</div>
								</div>
							</div>
					   
					</div>    
							
					<div class="row">
						<div class="col-md-12">
							<section class="panel panel-default">
								<div class="panel-heading"><strong><span class="glyphicon glyphicon-th"></span>&nbsp;&nbsp;Ventas del Mes vs. Proyeccion</strong></div>
								<div class="panel-body" data-ng-controller="morrisChartCtrl">
										<div id="chartventas"></div>
								</div>
							</section> 
						</div>
					</div>
					<div class="row">
						<div class="col-md-12">
							<section class="panel panel-default">
								<div class="panel-heading"><strong><span class="glyphicon glyphicon-th"></span>&nbsp;&nbsp;Ventas por día Mes vs. Proyeccion</strong></div>
								<div class="panel-body" data-ng-controller="morrisChartCtrl">
										<div id="chartdias"></div>
								</div>
							</section>
							<br/>
							<br/>
						</div>
					</div>
				</div>
			 
				<div id="contenedordealertas" style="display:block;">
					<div class="row">
						<div class="col-md-12" id="mensaje" style="text-align: center;">
							Seleciona tus criterios y presiona "Filtrar"
						</div>
					</div>
				</div>	
			</div>


				
			<script>       

				function salir(){
								localStorage.clear();
								window.location='index.html';
							}

			$(window).ready(function(){
				$('#lafecha').datepicker({
					showAnim: 'slideDown',
					showOtherMonths: true,
					dateFormat: 'yy-mm-dd',
					dayNamesMin: ['Dom', 'Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab'],
				});
				//$( "#formalocales" ).change(function() {
					
				//});
				

				document.getElementById("chartdias").innerHTML="";
				document.getElementById("chartventas").innerHTML="";
				
				var elget=window.location.search.replace("?", "");
				var parejas= elget.split("&");
				var intermedio=parejas[0].split("=");
				var usuario=intermedio[1];
				
				var intermedio2=parejas[1].split("=");
				var password=intermedio2[1];
				var intermedio3=parejas[2].split("=");
				var empresa = $.trim(intermedio3[1]);
				$('#id_emp').val(empresa);
				
				$('#welcome').html('Bienvenido  '+usuario)
								
				localStorage.setItem("username", usuario);
				localStorage.setItem("password", password);
				localStorage.setItem("empresa", empresa);
				
				 var username = localStorage.getItem('username');
				
				
				if(username ==''){
					window.location.href='index.html';
				}
				

				
				$.post("https://www.practisis.net/mobileapilogin.php",{
					usuario : usuario , password : password 
				}).done(function(json){
					var obj=jQuery.parseJSON(json);
					var busqueda= obj.Search;
					for(i=0; i<= (obj.locales.length -1); i++){
						var id_e= obj.locales[i].id_e;
						var emp= obj.locales[i].emp;
						$('#formalocales').append('<option value='+id_e+'>'+emp+'</option>');
					}
						
				});
			});
			 
			function metegraficos(datos1, datos3, datos2){
			new Morris.Line({
			  // ID of the element in which to draw the chart.
			  element: 'chartventas',
			 
			  data: datos1,
			 
			  xkey: 'x',
			 
			  ykeys: ['ventas', 'presupuestos'],
			 
			  labels: ['Ventas','Vs Proyeccion'],
			  parseTime: false,
			  lineColors: ['#E94B3B','#082356'],
			  resize: true
			});

			new Morris.Line({
			  
			  element: 'chartdias',
			  
			  data: datos3,
			  
			  xkey: 'x',
			  
			  ykeys: ['mes','mesant'],
			  
			  labels: ['Ventas', 'Vs Proyeccion'],
			  parseTime: false,
			  lineColors: ['#E94B3B', '#082356'],
			  resize: true
			});


			document.getElementById("bntfiltrar").innerHTML="Filtrar";
			document.getElementById("bntfiltrar").className="btn btn-success";
			$('#consulta').css('display','none');
			$('#otraConsulta').css('display','block');
			var valor = $("#formalocales option:selected").html();
			var resLocal = valor.replace('_',' ');

			var lafecha = $('#lafecha').val();
			var detalleLocal =resLocal+'&nbsp;&nbsp;&nbsp;&nbsp;        fecha:'+lafecha;
			$('#datosLocalSeleccionado').css('text-transform','uppercase');
			$('#datosLocalSeleccionado').css('font-size','18px');
			$('#datosLocalSeleccionado').css('color','blue');
			$('#datosLocalSeleccionado').css('font-weight','bolder');
			$('#datosLocalSeleccionado').html(detalleLocal);
			}        
				function nuevaConsulta(){
					window.location ='';
					$('#consulta').css('display','block');
					$('#otraConsulta').css('display','none');
				}
				function inicia(){
				var local= $('#formalocales').val();
				//alert(local);
					//if(local == 0){
						//$('#formalocales').effect('shake');
					//}else{

						document.getElementById("contenedordealertas").style.display='block';
						document.getElementById("contenedordedatos").style.display='none';
						document.getElementById("mensaje").innerHTML="Cargando...espere por favor.<br><img src='images/loader.gif' width='30px'/>";
						document.getElementById("bntfiltrar").innerHTML="<img src='images/loader.gif' width='20px'/>";
						document.getElementById("bntfiltrar").className="btn btn-default";


						var sel = document.getElementById("formalocales");

						var emp = $('#id_emp').val();
						console.log(local);

						var xmlhttp=false;
						if (!xmlhttp && typeof XMLHttpRequest!='undefined') { try {xmlhttp = new XMLHttpRequest(); } catch (e) { xmlhttp=false;}}
						if (!xmlhttp && window.createRequest) {	try { xmlhttp = window.createRequest();} catch (e) { xmlhttp=false;}}
						xmlhttp.open("GET","https://www.practisis.net/mobileapi.php?&date="+document.getElementById("lafecha").value+"&local="+local+"&emp="+emp,true);
						xmlhttp.onreadystatechange=function() {
						if (xmlhttp.readyState==4){
							if(xmlhttp.status==200){	

						var respuesta=xmlhttp.responseText;
						var datos= respuesta.split("$");
						var primerosdatos=datos[0].split("|");
						document.getElementById("campoventas").innerHTML=primerosdatos[0];
						document.getElementById("campoticket").innerHTML=primerosdatos[2];
						document.getElementById("campotransacciones").innerHTML=primerosdatos[1];

						document.getElementById("campotransaccionesDia").innerHTML=primerosdatos[5];
						document.getElementById("proyeccionAcumulada").innerHTML=primerosdatos[6];
						document.getElementById("proyeccionDia").innerHTML=primerosdatos[7];
						document.getElementById("utilidadAcumulada").innerHTML=primerosdatos[8];
						document.getElementById("costosTotales").innerHTML=primerosdatos[9];

						document.getElementById("campoventasDia").innerHTML=primerosdatos[3];
						document.getElementById("campoticketHoy").innerHTML=primerosdatos[4];
						document.getElementById("contenedordealertas").style.display='none';
						document.getElementById("contenedordedatos").style.display='block';
						var jsonaobjt=JSON.parse(datos[1]);
						var jsonaobjt3=JSON.parse(datos[2]);
						var jsonaobjt2=JSON.parse(datos[3]);
						metegraficos(jsonaobjt, jsonaobjt3,jsonaobjt2);

						}}} 
						xmlhttp.send(null);
					//}
				}

			cargate();
			function cargate(){
				
			}

			function datosiniciales(){
				
				var dt = new Date();
				// Display the month, day, and year. getMonth() returns a 0-based number.
				var month = dt.getMonth()+1;
				var day = dt.getDate();
				var year = dt.getFullYear();
				var lafecha= year + '-' + month + '-' + day;
				document.getElementById("lafecha").value=lafecha;
				
			}      
						
			</script>
						
		</body>
	</html>
